<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D temps reel</title>
    <style>
        body {
            overflow: hidden;
            margin: 0;
        }

        #canvas {
            background-color: cornsilk;
        }
    </style>
</head>
<body>
<iframe src="https://giphy.com/embed/MARFSIQQNQVWw" width="480" height="268" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/funimation-smile-my-hero-academia-MARFSIQQNQVWw"></a></p>
<button onclick="f()">Le bouton</button>
<canvas id="canvas" width="600px" height="400px"></canvas>
<script>
    const c = document.getElementById("canvas")
    const ctx = c.getContext("2d")
    const rectangles = [
        {x:0, y:0, dx:1, dy:1, color: "red"},
        {x:Math.round(c.width/2), y : Math.round(c.height/2), dx:1, dy:-1, color:"green"}
    ]
    const numRectangle = 0

    function animeRectangle(numRectangle){
        ctx.beginPath()
        ctx.lineWidth = "2"
        ctx.strokeStyle = rectangles[numRectangle].color
        ctx.rect( rectangles[numRectangle].x,  rectangles[numRectangle].y, 10, 10)
        ctx.stroke()
        if ( rectangles[numRectangle].x +  rectangles[numRectangle].dx <= 0 ||  rectangles[numRectangle].x +  rectangles[numRectangle].dx + 10 > c.width) {
            rectangles[numRectangle].dx =  -rectangles[numRectangle].dx
        }
        if ( rectangles[numRectangle].y +  rectangles[numRectangle].dy <= 0 ||  rectangles[numRectangle].y +  rectangles[numRectangle].dy + 10 > c.height) {
            rectangles[numRectangle].dy = - rectangles[numRectangle].dy
        }

        rectangles[numRectangle].x +=  rectangles[numRectangle].dx
        rectangles[numRectangle].y +=  rectangles[numRectangle].dy
    }

function f() {
    animeRectangle(0)

    setTimeout(f, 1)
    //while(true);
    //const p = document.createElement('p')
    //p.append(Date.now()+" - click");
    // document.body.appendChild(p)

}

    function f2(t) {
        animeRectangle(1)
        setTimeout(f2)
    }
f()
    f2()
</script>
</body>
</html>